import type { QueryHandler } from '@stratix/abstractions';
import { Result, EntityId } from '@stratix/primitives';
import type { Get<%- entityName %>ByIdQuery, Get<%- entityName %>ByIdOutput } from './Get<%- entityName %>ById.js';
import type { <%- entityName %>Id } from '../../domain/entities/<%- entityName %>.js';
import type { <%- entityName %>Repository } from '../../domain/repositories/<%- entityName %>Repository.js';

/**
 * Handler for Get<%- entityName %>ById query.
 */
export class Get<%- entityName %>ByIdHandler implements QueryHandler<Get<%- entityName %>ByIdQuery, Result<Get<%- entityName %>ByIdOutput>> {
  constructor(private readonly <%- entityNameCamel %>Repository: <%- entityName %>Repository) {}

  async handle(query: Get<%- entityName %>ByIdQuery): Promise<Result<Get<%- entityName %>ByIdOutput>> {
    try {
      const { id } = query.data;

      const <%- entityNameCamel %> = await this.<%- entityNameCamel %>Repository.findById(
        EntityId.from<'<%- entityName %>'>(id)
      );

      if (!<%- entityNameCamel %>) {
        return Result.fail(new Error('<%- entityName %> not found'));
      }

      return Result.ok({
        id: <%- entityNameCamel %>.id.value,
<% props.forEach((prop, index) => { -%>
        <%- prop.name %>: <%- entityNameCamel %>.<%- prop.name %><%= index < props.length - 1 ? ',' : '' %>
<% }); -%>
        createdAt: <%- entityNameCamel %>.createdAt,
        updatedAt: <%- entityNameCamel %>.updatedAt,
      });
    } catch (error) {
      return Result.fail(error as Error);
    }
  }
}
