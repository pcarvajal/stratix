import type { QueryHandler } from '@stratix/abstractions';
import { Result } from '@stratix/primitives';
import type { List<%- entityNamePlural %>Query, List<%- entityNamePlural %>Output } from './List<%- entityNamePlural %>.js';
import type { <%- entityName %>Repository } from '../../domain/repositories/<%- entityName %>Repository.js';

/**
 * Handler for List<%- entityNamePlural %> query.
 */
export class List<%- entityNamePlural %>Handler implements QueryHandler<List<%- entityNamePlural %>Query, Result<List<%- entityNamePlural %>Output>> {
  constructor(private readonly <%- entityNameCamel %>Repository: <%- entityName %>Repository) {}

  async handle(query: List<%- entityNamePlural %>Query): Promise<Result<List<%- entityNamePlural %>Output>> {
    try {
      const <%- entityNamePluralCamel %> = await this.<%- entityNameCamel %>Repository.findAll();

      return Result.ok({
        <%- entityNamePluralCamel %>: <%- entityNamePluralCamel %>.map((<%- entityNameCamel %>) => ({
          id: <%- entityNameCamel %>.id.value,
<% props.forEach((prop, index) => { -%>
          <%- prop.name %>: <%- entityNameCamel %>.<%- prop.name %><%= index < props.length - 1 ? ',' : '' %>
<% }); -%>
          createdAt: <%- entityNameCamel %>.createdAt,
          updatedAt: <%- entityNameCamel %>.updatedAt,
        })),
        total: <%- entityNamePluralCamel %>.length,
      });
    } catch (error) {
      return Result.fail(error as Error);
    }
  }
}
