import { <%= isAggregate ? 'AggregateRoot' : 'Entity' %>, EntityId } from '@stratix/primitives';
<% if (hasEvent) { %>
import { <%= eventName %> } from '../events/<%= eventName %>.js';
<% } %>

export type <%= entityName %>Id = EntityId<'<%= entityName %>'>;

export interface <%= entityName %>Props {
<% props.forEach(prop => { %>
  <%= prop.name %>: <%= prop.type %>;
<% }); %>
}

export class <%= entityName %> extends <%= isAggregate ? 'AggregateRoot' : 'Entity' %><<'<%= entityName %>'> {
  private constructor(
    id: <%= entityName %>Id,
<% props.forEach(prop => { %>
    private _<%= prop.name %>: <%= prop.type %>,
<% }); %>
    createdAt: Date,
    updatedAt: Date
  ) {
    super(id, createdAt, updatedAt);
  }

  // Getters
<% props.forEach(prop => { %>
  get <%= prop.name %>(): <%= prop.type %> {
    return this._<%= prop.name %>;
  }

<% }); %>

  // Business methods
<% props.forEach(prop => { %>
  update<%= naming.toPascalCase(prop.name) %>(<%= prop.name %>: <%= prop.type %>): void {
<% if (!skipValidation && prop.type === 'string') { %>
    if (!<%= prop.name %> || <%= prop.name %>.trim().length === 0) {
      throw new Error('<%= entityName %> <%= prop.name %> cannot be empty');
    }
<% } else if (!skipValidation && prop.type === 'number') { %>
    if (<%= prop.name %> < 0) {
      throw new Error('<%= entityName %> <%= prop.name %> cannot be negative');
    }
<% } %>
    this._<%= prop.name %> = <%= prop.name %>;
    this.touch();
  }

<% }); %>

  // Factory method
  static create(props: <%= entityName %>Props, id?: <%= entityName %>Id): <%= entityName %> {
    const <%= entityNameCamel %>Id = id ?? EntityId.create<<'<%= entityName %>'>>();
    const now = new Date();

    const <%= entityNameCamel %> = new <%= entityName %>(
      <%= entityNameCamel %>Id,
<% props.forEach(prop => { %>
      props.<%= prop.name %>,
<% }); %>
      now,
      now
    );

<% if (hasEvent) { %>
    <%= entityNameCamel %>.record(new <%= eventName %>(
      <%= entityNameCamel %>Id<% props.forEach(prop => { %>,
      props.<%= prop.name %><% }); %>
    ));
<% } %>

    return <%= entityNameCamel %>;
  }
}
