import { <%= repoName %> } from '../../domain/repositories/<%= repoName %>.js';
import { <%= entityName %>, <%= entityName %>Id } from '../../domain/entities/<%= entityName %>.js';
import type { Collection, Db } from 'mongodb';

export class <%= implClassName %> implements <%= repoName %> {
  private collection: Collection;

  constructor(private readonly db: Db) {
    this.collection = db.collection('<%= entityNameCamel %>s');
  }

  async findById(id: <%= entityName %>Id): Promise<<%= entityName %> | null> {
    const doc = await this.collection.findOne({ _id: id.value });

    if (!doc) {
      return null;
    }

    return this.mapToDomain(doc);
  }

  async save(<%= entityNameCamel %>: <%= entityName %>): Promise<void> {
    const doc = this.mapToPersistence(<%= entityNameCamel %>);

    await this.collection.updateOne(
      { _id: <%= entityNameCamel %>.id.value },
      { $set: doc },
      { upsert: true }
    );
  }

  async delete(id: <%= entityName %>Id): Promise<void> {
    await this.collection.deleteOne({ _id: id.value });
  }

  async findAll(): Promise<<%= entityName %>[]> {
    const docs = await this.collection
      .find({})
      .sort({ createdAt: -1 })
      .toArray();

    return docs.map((doc) => this.mapToDomain(doc));
  }

  private mapToDomain(doc: any): <%= entityName %> {
    // TODO: Implement proper mapping from MongoDB document to domain entity
    // This is a placeholder implementation
    throw new Error('Not implemented: mapToDomain');
  }

  private mapToPersistence(<%= entityNameCamel %>: <%= entityName %>): any {
    return {
      _id: <%= entityNameCamel %>.id.value,
      createdAt: <%= entityNameCamel %>.createdAt,
      updatedAt: <%= entityNameCamel %>.updatedAt,
      // TODO: Add entity-specific fields
    };
  }
}
